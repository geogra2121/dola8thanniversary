<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>ドーラ様8周年記念サイト</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="ドーラ様の活動8周年記念サイトになります。">
  <link rel="stylesheet" href="css/style.css">
  <!--↓自作↓-->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ランダム再生</title>
  <!--↑自作↑-->
</head>
<!--↓自作↓-->
<style>
  /* 全体 */
  body {
    margin: 0;
    padding: 16px;
    font-family: sans-serif;
    text-align: center;
  }
  
  /* コンテンツ幅（PC用） */
  .container {
    max-width: 800px;
    margin: 0 auto;
  }
  
  /* 動画の比率を維持（16:9） */
  #player-wrapper {
    position: relative;
    width: 100%;
    padding-top: 56.25%; /* 16:9 */
    margin-bottom: 16px;
  }
  
  #player-wrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100% !important;
    height: 100% !important;
  }
  
  /* ボタン */
  button {
    width: 100%;
    max-width: 300px;
    padding: 12px;
    font-size: 16px;
  }
  
  /* 配信タイトル */
  #clip-title {
    font-size: 18px;
    margin: 12px 0;
    font-weight: bold;
  }
  
  /* PCでは少し余裕を持たせる */
  @media (min-width: 768px) {
    button {
      font-size: 18px;
    }
  }
  
  /* コメントの見た目調整 */
  #clip-comment {
    margin-top: 8px;
    font-size: 15px;
    margin: 12px 0;
    font-weight: bold;
  }
</style>
<!--↑自作↑-->

<body>
  <header>
    <h1 id="logo">
      <img src="images/logo.png" alt="ドーラ様8周年記念サイト">
      <span>
      </span>
    </h1>
    <!--開閉ブロック-->
    <div id="menubar">
      <nav>
        <ul>
          <li>
            <a href="index.html">Home</a>
          </li>
          <li>
            <a href="kokosuki.html">ドーラ様の衣装のここが好き</a>
          </li>
          <li>
            <a href="littlelife.html">全国の小さき命</a>
          </li>
          <li>
            <a href="dolasecret.html">ドレイクのひみつ</a>
          </li>
        </ul>
      </nav>
      <ul class="icons">
        <li>
          <a href="#">
            <i class="fa-brands fa-x-twitter"></i>
          </a>
        </li>
        <li>
          <a href="#">
            <i class="fab fa-line"></i>
          </a>
        </li>
        <li>
          <a href="#">
            <i class="fab fa-youtube"></i>
          </a>
        </li>
        <li>
          <a href="#">
            <i class="fab fa-instagram"></i>
          </a>
        </li>
      </ul>
    </div>
    <!--/#menubar-->
  </header>
  <main>
    <!--↓自作↓-->
    <h1>ドーラ様の配信切り抜きランダム再生</h1>
    <div class="container">
      <div id="player-wrapper">
        <div id="player">
        </div>
      </div>
      <h2 id="clip-title">　</h2>
      <button onclick="playRandom()">ランダム再生</button>
      <p id="clip-comment"></p>
    </div>
    <!--↑自作↑-->
  </main>
  <footer>
    <small>Copyright©
      <a href="index.html">DOLA_fanevent</a>All Rights Reserved.</small>
    <span class="pr">
      <a href="https://template-party.com/" target="_blank">《Web Design:Template-Party》</a>
    </span>
  </footer>
  <!--ページの上部へ戻るボタン-->
  <div class="pagetop">
    <a href="#">
      <i class="fas fa-angle-double-up"></i>
    </a>
  </div>
  <!--開閉ボタン（ハンバーガーアイコン）-->
  <div id="menubar_hdr">
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
  </div>
  <!--jQueryの読み込み-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!--lightbox用jsファイルの読み込み-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.10.0/js/lightbox-plus-jquery.min.js"></script>
  <!--このテンプレート専用のスクリプト-->
  <script src="js/main.js"></script>
  <!--↓自作↓-->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxcJK9nLRi-yQ5yxIjwiojwGFMHKTfMFUbnITHJD0LI9jdsdqjHAs4uu1ITn6rYe5f9/exec";
  const titleEl = document.getElementById("clip-title");
  
  let clips = [];
  let player;
  let stopTimer = null;
  //コメント取得
  const commentEl = document.getElementById("clip-comment");
  
  fetch(API_URL)
    .then(res => res.json())
    .then(data => clips = data);
  
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      playerVars: {
        playsinline: 1 //スマホで全画面強制を防ぐ
      }
    });
  }
  
  function playRandom() {
    if (clips.length === 0 || !player) return;
  
    //前回の停止タイマーを必ず消す
    if (stopTimer) {
      clearTimeout(stopTimer);
      stopTimer = null;
    }
  
    const clip = clips[Math.floor(Math.random() * clips.length)];
    const duration = (clip.end - clip.start) * 1000;
    
    //タイトル表示
    titleEl.textContent = clip.title || "";
    
    // コメント表示
    if (clip.comments) {
      const commentList = clip.comments
        .split(/\n|\|/)
        .map(c => c.trim())
        .filter(c => c !== "");
  
      commentEl.textContent =
        commentList.length > 0
          ? commentList[Math.floor(Math.random() * commentList.length)]
          : "";
    } else {
      commentEl.textContent = "";
    }
  
    player.loadVideoById({
      videoId: clip.videoId,
      startSeconds: Number(clip.start)
    });
  
    //今回分のタイマーだけをセット
    stopTimer = setTimeout(() => {
      player.stopVideo();
      stopTimer = null;
    }, duration);
  }
  </script>
  <!--↑自作↑-->
</body>

</html>