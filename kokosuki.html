<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>ドーラ様8周年記念サイト</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="ドーラ様の活動8周年記念サイトになります。">
  <link rel="stylesheet" href="css/style.css">
  <!--↓自作↓-->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ドーラ様の衣装のここが好き</title>
  <!--↑自作↑-->
</head>
<!--↓自作↓-->
<style>
body { margin: 0; font-family: sans-serif; }

/* サムネイル */
#thumbnail-bar {
  display: grid;
  grid-template-columns: repeat(8, auto); /*一行の最大画像数*/
  justify-content: start;
  gap: 8px;
  padding: 8px;
  min-height: 80px;
  border-bottom: 1px solid #ccc;
  position: sticky;
  top: 0px;
  background: #fff;
  z-index: 500;
  
  background: rgba(255, 0, 0, 0.1);
}

.thumbnail {
  width: 80px;
  height: 60px;
  object-fit: cover;
}

#thumbnail-bar img {
  height: 60px;
  width: auto;
  object-fit: contain;
  cursor: pointer;
}

#menubar {
  z-index: 1000;
}

#menubar_hdr {
  z-index: 1000;
}

/* セクション */
.section {
  position: relative;
  display: flex;
  padding: 40px;
  border-bottom: 1px solid #ddd;
  scroll-margin-top: 90px;
}

.image-wrapper {
  width: 50%;
}

.image-wrapper img {
  width: 100%;
  display: block;
}

.comments {
  width: 50%;
  padding-left: 20px;
}

.comment {
  margin-bottom: 10px;
  cursor: pointer;
  padding: 4px;
}

.comment.active {
  background: #ffecec;
  border-left: 4px solid red;
  color: #000;   /* クリック時（黒） */
}

/* SVG */
.annotation {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.annotation polyline {
  stroke: #888;
  stroke-width: 2;
  fill: none;
  pointer-events: auto;
}

.annotation polyline.active {
  stroke: red;
  stroke-width: 3;
}

.annotation circle {
  fill: #888;
}

.annotation circle.active {
  fill: red;
}

:root {
  --menubar-height: 60px;
  --thumbnail-height: 20px; /* PC用 */
}

@media screen and (max-width: 768px) {
  #thumbnail-bar {
    grid-template-columns: repeat(4, auto);
  }
  :root {
  --menubar-height: 60px;
  --thumbnail-height: 85px; /* スマホ用 */
}
}

.section {
  scroll-margin-top: calc(
    var(--menubar-height) + var(--thumbnail-height)
  );
  outline: 2px dashed blue;
}


</style>
<!--↑自作↑-->

<body>
  <header>
    <h1 id="logo">
      <img src="images/logo.png" alt="ドーラ様8周年記念サイト">
      <span>
      </span>
    </h1>
    <!--開閉ブロック-->
    <div id="menubar">
      <nav>
        <ul>
          <li>
            <a href="index.html">Home</a>
          </li>
          <li>
            <a href="kokosuki.html">ドーラ様の衣装のここが好き</a>
          </li>
          <li>
            <a href="littlelife.html">全国の小さき命</a>
          </li>
          <li>
            <a href="dolasecret.html">ドレイクのひみつ</a>
          </li>
          <li>
            <a href="dolabutton.html">ドーラ様の配信切り抜きランダム再生ボタン</a>
          </li>
        </ul>
      </nav>
      <ul class="icons">
        <li>
          <a href="#">
            <i class="fa-brands fa-x-twitter"></i>
          </a>
        </li>
        <li>
          <a href="#">
            <i class="fab fa-line"></i>
          </a>
        </li>
        <li>
          <a href="#">
            <i class="fab fa-youtube"></i>
          </a>
        </li>
        <li>
          <a href="#">
            <i class="fab fa-instagram"></i>
          </a>
        </li>
      </ul>
    </div>
    <!--/#menubar-->
  </header>
  <main>
    <!--↓自作↓-->
<div id="thumbnail-bar"></div>
<div id="content"></div>
    <!--↑自作↑-->
  </main>
  <footer>
    <small>Copyright©
      <a href="index.html">DOLA_fanevent</a>All Rights Reserved.</small>
    <span class="pr">
      <a href="https://template-party.com/" target="_blank">《Web Design:Template-Party》</a>
    </span>
  </footer>
  <!--ページの上部へ戻るボタン-->
  <div class="pagetop">
    <a href="#">
      <i class="fas fa-angle-double-up"></i>
    </a>
  </div>
  <!--開閉ボタン（ハンバーガーアイコン）-->
  <div id="menubar_hdr">
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
  </div>
  <!--jQueryの読み込み-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!--lightbox用jsファイルの読み込み-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.10.0/js/lightbox-plus-jquery.min.js"></script>
  <!--このテンプレート専用のスクリプト-->
  <script src="js/main.js"></script>
  <!--↓自作↓-->
<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbwmZXpP17JE9Zam3Et5eZa4-M7m7xZkYnNYr4VPp2Ym2T8bjm1LHLFCs48fdtaVUovv/exec";

function clearActive() {
  document.querySelectorAll(".active").forEach(el =>
    el.classList.remove("active")
  );
}

fetch(GAS_URL)
  .then(r => r.json())
  .then(sections => {

    const content = document.getElementById("content");
    const thumbBar = document.getElementById("thumbnail-bar");

    sections.forEach(section => {

      /* サムネイル */
      const thumb = document.createElement("img");
      thumb.src = section.image;
      thumb.onclick = () =>
        document.getElementById(section.id)
          .scrollIntoView({ behavior: "smooth" });
      thumbBar.appendChild(thumb);

      /* セクション */
      const sec = document.createElement("div");
      sec.className = "section";
      sec.id = section.id;

      sec.innerHTML = `
        <svg class="annotation"></svg>

        <div class="image-wrapper">
          <img src="${section.image}">
        </div>

        <div class="comments">
          ${section.comments.map((c,i) =>
            `<div class="comment" data-key="${section.id}-${i}">${c.text}</div>`
          ).join("")}
        </div>
      `;

      content.appendChild(sec);

      requestAnimationFrame(() => drawLines(sec, section));
    });

    /* クリック連動 */
    document.addEventListener("click", e => {
      const key = e.target.dataset.key;
      if (!key) return;

      clearActive();
      document.querySelectorAll(`[data-key="${key}"]`)
        .forEach(el => el.classList.add("active"));
    });
  });

function drawLines(sectionEl, sectionData) {
  const svg = sectionEl.querySelector(".annotation");
  const img = sectionEl.querySelector(".image-wrapper img");

  const sectionRect = sectionEl.getBoundingClientRect();
  const imgRect = img.getBoundingClientRect();

  svg.setAttribute(
    "viewBox",
    `0 0 ${sectionRect.width} ${sectionRect.height}`
  );

  sectionData.comments.forEach((c, i) => {
    const key = `${sectionData.id}-${i}`;
    const commentEl = sectionEl.querySelector(`.comment[data-key="${key}"]`);
    const commentRect = commentEl.getBoundingClientRect();

    /* 始点（画像指定位置） */
    const sx = imgRect.left
      + imgRect.width * (c.x / 100)
      - sectionRect.left;

    const sy = imgRect.top
      + imgRect.height * (c.y / 100)
      - sectionRect.top;

    /* 終点（コメント左中央） */
    const ex = commentRect.left - sectionRect.left;
    const ey = commentRect.top + commentRect.height / 2 - sectionRect.top;

    const midX = (sx + ex) / 2;

    /* 折れ線 */
    const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
    polyline.dataset.key = key;
    polyline.setAttribute(
      "points",
      `${sx},${sy} ${midX},${sy} ${midX},${ey} ${ex},${ey}`
    );

    /* 先端の丸（画像側） */
    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    circle.dataset.key = key;
    circle.setAttribute("cx", sx);
    circle.setAttribute("cy", sy);
    circle.setAttribute("r", 4);

    svg.appendChild(polyline);
    svg.appendChild(circle);
  });
}
</script>
  <!--↑自作↑-->
</body>

</html>